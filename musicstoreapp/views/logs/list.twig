{% extends "layout.twig" %}
{% block title %}Logs{% endblock %}

{% block main_container %}
    <div class="container">
        <h2>Lista de logs</h2>

        {% if error %}
            <div class="alert alert-danger">
                <p>{{ error }}</p>
            </div>
        {% endif %}

        <div class="row mb-3">
            <div class="col-sm-4">
                <select id="logTypeFilter" class="form-control" name="logType">
                    {% for type in logTypes %}
                        <option value="{{ type }}"
                                {% if type == selectedType %}selected{% endif %}>
                            {{ type }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-2">
                <button id="deleteLogsBtn" class="btn btn-danger">Eliminar</button>
            </div>
        </div>

        <div class="table-responsive">
            {% if logs and logs.length > 0 %}
                <table class="table table-hover" id="logsTable">
                    <thead>
                    <tr>
                        <th>{{ i18n.logs_datetime }}</th>
                        <th>{{ i18n.logs_type }}</th>
                        <th>{{ i18n.logs_description }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for log in logs %}
                        <tr>
                            <td>{{ log.timestamp|date('d-m-Y H:i:s') }}</td>
                            <td>{{ log.logType }}</td>
                            <td>{{ log.description }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-info">No hay logs en el sistema</div>
            {% endif %}
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function() {
            // Cambiar tipo de log
            $('#logTypeFilter').change(function() {
                window.location.href = '/logs/list?type=' + $(this).val();
            });

            // Eliminar logs del tipo seleccionado
            $('#deleteLogsBtn').click(function() {
                if (confirm('¿Está seguro de que desea eliminar estos logs?')) {
                    let type = $('#logTypeFilter').val();
                    $.ajax({
                        url: '/logs/delete',
                        type: 'POST',
                        data: { type: type },
                        dataType: 'json',
                        success: function(response) {
                            if (response.success) {
                                location.reload();
                            } else {
                                alert('Error al eliminar los logs: ' + response.error);
                            }
                        },
                        error: function(xhr, status, error) {
                            alert('Error en la solicitud: ' + error);
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}
